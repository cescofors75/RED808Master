<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>RED808 ‚Äî Patchbay</title>
<link rel="stylesheet" href="patchbay.css">
</head>
<body>
<div id="patchbay">
  <!-- Header -->
  <header id="pbHeader">
    <button class="pb-hdr-btn" onclick="goBack()" title="Volver">‚úï</button>
    <h1>RED808 <span>PATCHBAY</span></h1>
    <button class="pb-hdr-btn" id="pbMenuBtn" onclick="togglePBMenu()" title="Workspace">‚ò∞</button>
    <div id="pbMenu" class="pb-menu hidden">
      <div class="pb-menu-title">Workspace</div>
      <button onclick="pbClearAll()">üóë Borrar todo</button>
      <button onclick="pbResetLayout()">üìê Reset layout</button>
      <button onclick="pbAutoRoute()">‚ö° Auto-route</button>
      <button onclick="pbBuildChain()">üß¨ Encadenar FX</button>
      <button onclick="pbOrganizeNodes()">üß≠ Organizar nodos</button>
      <button onclick="pbToggleSignalDemo()">üé¨ Demo se√±al</button>

      <div class="pb-menu-title">Live</div>
      <button id="pbHeatToggleBtn" onclick="pbToggleHeatMode()">üå° Heat ON</button>
      <button id="pbQuantizeBtn" onclick="pbToggleSceneQuantize()">‚è± Quantize ON</button>

      <div class="pb-menu-title">Snapshots</div>
      <button onclick="pbSaveSnapshot('A')">üì∏ Guardar Snap A</button>
      <button onclick="pbLoadSnapshot('A')">üéØ Cargar Snap A</button>
      <button onclick="pbSaveSnapshot('B')">üì∏ Guardar Snap B</button>
      <button onclick="pbLoadSnapshot('B')">üéØ Cargar Snap B</button>

      <div class="pb-menu-title">Presets</div>
      <button onclick="pbOpenPresetPanel()">üß© Abrir browser</button>
      <button onclick="pbSavePreset()">üíæ Guardar preset</button>
      <button onclick="pbLoadPreset()">üìÇ Cargar preset</button>
    </div>
  </header>
  <div id="pbMenuBackdrop" class="hidden" onclick="togglePBMenu()"></div>

  <!-- Toolbar -->
  <div id="pbToolbar">
    <div class="pb-brand">
      <span class="pb-logo"><b>R</b><b>E</b><b>D</b><em>8</em><em>0</em><em>8</em></span>
      <span class="pb-subtitle">SIGNAL PATCH</span>
    </div>
    <div class="pb-fx-buttons" aria-label="Biblioteca de FX">
      <div class="pb-source-bar" aria-label="Fuentes de sampler">
        <span class="pb-source-title">SOURCES <b id="pbSourceCount">0/16</b></span>
        <select id="pbSourcePicker" class="pb-source-picker" aria-label="Seleccionar sampler"></select>
        <button id="pbAddSourceBtn" class="pb-source-btn" onclick="pbAddSelectedSource()">+ SOURCE</button>
        <select id="pbActiveSourcePicker" class="pb-source-picker" aria-label="Seleccionar fuente activa"></select>
        <button id="pbRemoveSourceBtn" class="pb-source-btn pb-source-btn-remove" onclick="pbRemoveSelectedSource()">- SOURCE</button>
        <button id="pbAddAllSourcesBtn" class="pb-source-btn" onclick="pbAddAllSources()">+ ALL</button>
      </div>
      <div class="pb-fx-group">
        <div class="pb-fx-group-head">
          <span class="pb-fx-group-title">FILTERS</span>
          <span class="pb-fx-group-subtitle">Track tone shaping</span>
        </div>
        <div class="pb-fx-group-btns">
          <button class="pb-add-btn" data-fx="lowpass"   onclick="pbAddEffect('lowpass')">LP</button>
          <button class="pb-add-btn" data-fx="highpass"  onclick="pbAddEffect('highpass')">HP</button>
          <button class="pb-add-btn" data-fx="bandpass"  onclick="pbAddEffect('bandpass')">BP</button>
          <button class="pb-add-btn" data-fx="notch"     onclick="pbAddEffect('notch')">NOTCH</button>
          <button class="pb-add-btn" data-fx="allpass"   onclick="pbAddEffect('allpass')">ALLP</button>
          <button class="pb-add-btn" data-fx="peaking"   onclick="pbAddEffect('peaking')">PEAK</button>
          <button class="pb-add-btn" data-fx="lowshelf"  onclick="pbAddEffect('lowshelf')">LOSHELF</button>
          <button class="pb-add-btn" data-fx="highshelf" onclick="pbAddEffect('highshelf')">HISHELF</button>
          <button class="pb-add-btn" data-fx="resonant"  onclick="pbAddEffect('resonant')">RESO</button>
        </div>
      </div>
      <div class="pb-fx-group">
        <div class="pb-fx-group-head">
          <span class="pb-fx-group-title">FX</span>
          <span class="pb-fx-group-subtitle">Dynamics & ambience</span>
        </div>
        <div class="pb-fx-group-btns">
          <button class="pb-add-btn" data-fx="echo"        onclick="pbAddEffect('echo')">REVERB</button>
          <button class="pb-add-btn" data-fx="delay"       onclick="pbAddEffect('delay')">DELAY</button>
          <button class="pb-add-btn" data-fx="bitcrusher"  onclick="pbAddEffect('bitcrusher')">BITCRUSH</button>
          <button class="pb-add-btn" data-fx="distortion"  onclick="pbAddEffect('distortion')">DIST</button>
          <button class="pb-add-btn" data-fx="compressor"  onclick="pbAddEffect('compressor')">COMP</button>
          <button class="pb-add-btn" data-fx="flanger"     onclick="pbAddEffect('flanger')">FLANGER</button>
          <button class="pb-add-btn" data-fx="phaser"      onclick="pbAddEffect('phaser')">PHASER</button>
        </div>
      </div>
    </div>
    <div id="pbMacroPanel">
      <div class="pb-macro-head">
        <span>MACROS</span>
        <div class="pb-macro-scenes">
          <button id="pbMacroSceneA" onclick="pbSelectMacroScene('A')">A</button>
          <button id="pbMacroSceneB" onclick="pbSelectMacroScene('B')">B</button>
          <button id="pbMacroSceneC" onclick="pbSelectMacroScene('C')">C</button>
          <button id="pbMacroSceneD" onclick="pbSelectMacroScene('D')">D</button>
        </div>
      </div>
      <div class="pb-macro-grid">
        <label>M1 TONE <input id="pbMacro1" type="range" min="0" max="100" value="45"></label>
        <label>M2 SPACE <input id="pbMacro2" type="range" min="0" max="100" value="35"></label>
        <label>M3 GLUE <input id="pbMacro3" type="range" min="0" max="100" value="55"></label>
        <label>M4 PUMP <input id="pbMacro4" type="range" min="0" max="100" value="40"></label>
      </div>
      <div class="pb-macro-actions">
        <button onclick="pbSaveMacroScene()">Guardar escena</button>
        <button onclick="pbLoadMacroScene()">Cargar escena</button>
      </div>
    </div>
    <div class="pb-help">DRAG <span class="dot out"></span> TO CONNECT ¬∑ CLICK WIRE TO SELECT ¬∑ SUPR/BACKSPACE TO REMOVE ¬∑ DRAG NODE TO MOVE</div>
  </div>

  <!-- Canvas area -->
  <div id="pbCanvas">
    <div id="pbViewControls">
      <button id="pbToolHandBtn" onclick="pbToggleHandTool()" title="Mover grid (mano)">‚úã</button>
      <button id="pbToolSelectBtn" onclick="pbToggleSelectTool()" title="Selecci√≥n m√∫ltiple">‚ñ≠</button>
      <button onclick="pbZoomOut()" title="Zoom -">‚àí</button>
      <span id="pbZoomValue">100%</span>
      <button onclick="pbZoomIn()" title="Zoom +">+</button>
      <button onclick="pbZoomReset()" title="Reset zoom">1:1</button>
      <button id="pbGridToggleBtn" onclick="pbToggleGrid()" title="Mostrar/Ocultar cuadr√≠cula">GRID</button>
    </div>
    <div id="pbSelectionBox" aria-hidden="true"></div>
    <div id="pbWorld">
      <svg id="pbSVG">
        <defs>
          <filter id="cableGlow">
            <feGaussianBlur stdDeviation="3" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
          <filter id="nodeGlow">
            <feGaussianBlur stdDeviation="6" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
      </svg>
      <div id="pbNodes"></div>
    </div>
  </div>

  <!-- Parameter Editor Popup -->
  <div id="pbParamEditor" class="hidden">
    <div class="pb-param-header">
      <span id="pbParamTitle">EFFECT</span>
      <button onclick="closeParamEditor()">‚úï</button>
    </div>
    <div id="pbParamBody"></div>
  </div>

  <div id="pbPresetPanel" class="hidden">
    <div class="pb-preset-head">
      <span>PRESETS PATCHBAY</span>
      <button onclick="pbClosePresetPanel()">‚úï</button>
    </div>
    <div class="pb-preset-save">
      <input id="pbPresetNameInput" type="text" placeholder="Nombre preset usuario..." maxlength="48">
      <button onclick="pbSavePresetFromPanel()">Guardar</button>
    </div>
    <div class="pb-preset-browser-tools">
      <input id="pbPresetSearchInput" type="text" placeholder="Buscar por nombre, tag o descripci√≥n..." oninput="pbRefreshPresetBrowser()">
      <label><input id="pbPresetFavOnly" type="checkbox" onchange="pbRefreshPresetBrowser()">‚≠ê Favoritos</label>
    </div>
    <div class="pb-preset-sections">
      <section>
        <h3>F√°brica</h3>
        <div id="pbFactoryPresetList" class="pb-preset-list"></div>
      </section>
      <section>
        <h3>Usuario</h3>
        <div id="pbUserPresetList" class="pb-preset-list"></div>
      </section>
    </div>
  </div>

  <!-- Footer -->
  <footer id="pbFooter">
    <span class="pb-status-dot" id="pbWsStatus"></span>
    <span>NODES: <b id="pbNodeCount">0</b></span>
    <span>‚Äî</span>
    <span>CABLES: <b id="pbCableCount">0</b></span>
    <span class="pb-footer-brand">RED808 / PATCHBAY v1.0</span>
  </footer>
</div>
<script src="patchbay.js"></script>
</body>
</html>
